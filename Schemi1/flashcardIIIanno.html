<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroCards III Anno - Specializzazione Neurologia</title>
    <style>
        /* ... tutto il CSS precedente rimane uguale ... */
        .back-link {
            display: inline-block;
            background: #1976d2;
            color: white;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: clamp(11px, 3.5vw, 14px);
        }
        .back-link:hover {
            background: #1565c0;
        }
        .back-link::before {
            content: "‚Üê ";
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f9fafb;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(to bottom right, #1e1b4b, #312e81, #1e1b4b);
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            animation: pulse 15s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        /* Glass Morphism Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header with Glassmorphism */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .header h1 {
            font-size: 2.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header .subtitle {
            font-size: 1.1rem;
            color: #a5b4fc;
            margin-top: 5px;
        }

        /* Stats Cards with Animation */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient);
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: transparent;
        }

        .stat-card:hover::before {
            opacity: 0.3;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        /* Difficulty Level Indicator */
        .difficulty-indicator {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .difficulty-beginner { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .difficulty-intermediate { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .difficulty-advanced { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        /* Modal for Category Selection */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(30, 27, 75, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            margin: 50px auto;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Category Checkboxes */
        .category-list {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .category-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .category-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }

        /* Controls Section */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .control-btn {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: #a5b4fc;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
        }

        .control-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
            color: white;
        }

        /* Flashcard with 3D Effect */
        .flashcard {
            background: transparent;
            border-radius: 20px;
            margin: 0 auto 30px;
            max-width: 700px;
            height: 450px;
            position: relative;
            cursor: pointer;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        /* FIX PRINCIPALE: Aggiungo la regola mancante per il flip su desktop */
        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: rgba(30, 27, 75, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .flashcard-back {
            transform: rotateY(180deg);
            background: rgba(45, 40, 100, 0.9);
        }

        /* Category Badge */
        .category-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--gradient);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* Edit Button */
        .edit-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Improved Difficulty Buttons with Icons */
        .difficulty-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
        }

        .difficulty-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
            min-width: 120px;
        }

        .difficulty-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }

        .difficulty-btn:hover::after {
            width: 150px;
            height: 150px;
        }

        .easy {
            background: var(--success);
            color: white;
        }

        .medium {
            background: var(--warning);
            color: white;
        }

        .hard {
            background: var(--danger);
            color: white;
        }

        /* Enhanced Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            height: 12px;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-fill {
            background: var(--gradient);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progress-shine 2s linear infinite;
        }

        @keyframes progress-shine {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        /* Session Complete */
        .session-complete {
            background: rgba(30, 27, 75, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Edit Modal */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
        }

        .edit-content {
            background: rgba(30, 27, 75, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 700px;
            margin: 50px auto;
            max-height: 80vh;
            overflow-y: auto;
        }

        .edit-content h3 {
            margin-bottom: 20px;
            color: #a5b4fc;
        }

        .edit-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .edit-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
        }

        textarea.edit-input {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-up {
            animation: slideUp 0.5s ease;
        }

        .bounce {
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        /* Stili per il testo della Domanda e della Risposta nelle flashcard */
        .flashcard-front p,
        .flashcard-back p {
            max-height: 220px;  
            overflow-y: auto;   
            padding-right: 10px;
            line-height: 1.7;   
            text-align: left;   
            width: 90%;         
            margin-top: 15px;   
            margin-bottom: 15px;
            color: #e2e8f0;
            font-size: 16px;
        }

        /* Se vuoi che la domanda abbia un font leggermente pi√π grande della risposta */
        .flashcard-front p {
            font-size: 18px;
            line-height: 1.8;
        }

        /* Manteniamo 'white-space: pre-line;' per la risposta se vuoi che gli "a capo" 
           nel testo originale siano rispettati. */
        .flashcard-back p {
            white-space: pre-line;
        }

        /* Stili OPZIONALI per rendere la scrollbar pi√π carina (per Chrome, Edge, Safari) */
        .flashcard-front p::-webkit-scrollbar,
        .flashcard-back p::-webkit-scrollbar {
            width: 8px;
        }

        .flashcard-front p::-webkit-scrollbar-track,
        .flashcard-back p::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .flashcard-front p::-webkit-scrollbar-thumb,
        .flashcard-back p::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .flashcard-front p::-webkit-scrollbar-thumb:hover,
        .flashcard-back p::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Empty State Styles */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #a5b4fc;
        }

        .empty-state p {
            color: #94a3b8;
            margin-bottom: 25px;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(99, 102, 241, 0.1);
            color: #a5b4fc;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .social-link:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateY(-2px);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(30, 27, 75, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 30px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 3000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--success);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        /* Keyboard Shortcuts */
        .keyboard-hints {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(30, 27, 75, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.875rem;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .keyboard-hints:hover {
            opacity: 1;
        }

        .keyboard-hint {
            margin: 5px 0;
        }

        .key {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 5px;
            font-family: monospace;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Media Queries per Mobile - mantengono la regola esistente */
        @media (max-width: 768px) {
            .modal-content, .edit-content {
                margin: 20px auto;
                padding: 20px;
                max-width: 95%;
                max-height: 90vh;
            }

            .category-list {
                gap: 10px;
            }

            .category-item {
                padding: 12px;
            }

            .edit-input {
                padding: 12px;
                font-size: 16px;
            }

            .control-btn {
                padding: 12px 20px;
                font-size: 15px;
            }

            .flashcard {
                height: auto;
                min-height: 350px;
                max-height: 70vh;
                margin-bottom: 20px;
            }

            /* La regola mobile per il flip rimane la stessa */
            .flashcard.flipped {
                transform: rotateY(180deg);
                max-height: 90vh;
                min-height: 60vh;
            }
            
            .flashcard-front, .flashcard-back {
                padding: 20px 15px;
            }

            .flashcard-front p,
            .flashcard-back p {
                font-size: 16px;
                line-height: 1.6;
                max-height: 45vh;
                width: 100%;
                margin-top: 10px;
                margin-bottom: 10px;
            }
            
            .flashcard.flipped .flashcard-back p {
                max-height: 70vh;
            }

            .contatti {
                padding: 15px;
                font-size: 14px;
                text-align: center;
            }

            .contatti p {
                margin-bottom: 10px;
            }

            .contatti a {
                display: inline-block;
                margin: 5px;
            }

            .container {
                padding: 10px;
            }

            .header {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 0.9rem;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-bottom: 20px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-card h3 {
                font-size: 1.8rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                margin-bottom: 20px;
            }

            .control-btn {
                padding: 15px 20px;
                font-size: 16px;
                width: 100%;
            }

            .difficulty-buttons {
                flex-direction: column;
                width: 100%;
                gap: 10px;
                margin-top: 20px;
            }

            .difficulty-btn {
                width: 100%;
                padding: 15px;
                font-size: 16px;
            }

            .category-badge {
                font-size: 0.8rem;
                padding: 6px 12px;
                top: 15px;
                right: 15px;
            }

            .edit-btn {
                top: 15px;
                left: 15px;
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .flashcard-front h2,
            .flashcard-back h2 {
                font-size: 1.3rem;
                margin-bottom: 12px;
            }

            .keyboard-hints {
                display: none;
            }

            div[style*="text-align: center"] {
                font-size: 1.1rem !important;
                margin: 15px 0 !important;
                font-weight: 600;
            }
        }

        /* Media query aggiuntiva per schermi molto piccoli */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.6rem;
            }

            .stats {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .flashcard {
                min-height: 320px;
                max-height: 65vh;
            }

            .flashcard-front p,
            .flashcard-back p {
                font-size: 15px;
                max-height: 40vh;
            }

            .control-btn {
                padding: 12px 16px;
                font-size: 15px;
            }

            .difficulty-btn {
                padding: 12px;
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üß† NeuroCards III Anno</h1>
            <p>Sistema Avanzato di Studio per la Specializzazione in Neurologia</p>
            <div class="subtitle">Terzo Anno - Ripetizione Spaziata Intelligente</div>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats">
            <div class="stat-card">
                <h3 id="cardsStudied">0</h3>
                <p>Carte Studiate</p>
            </div>
            <div class="stat-card">
                <h3 id="correctAnswers">0</h3>
                <p>Risposte Corrette</p>
            </div>
            <div class="stat-card">
                <h3 id="streak">0</h3>
                <p>Serie Corrente</p>
            </div>
            <div class="stat-card">
                <h3 id="totalProgress">0%</h3>
                <p>Progresso Totale</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="control-btn" onclick="openCategoryModal()">
                üìö Seleziona Argomenti
            </button>
            <button class="control-btn" onclick="shuffleCards()">
                üîÄ Mescola
            </button>
            <button class="control-btn" onclick="saveProgress()">
                üíæ Scarica Progresso
            </button>
            <button class="control-btn" onclick="loadProgress()">
                üìÇ Carica Progresso
            </button>
            <button class="control-btn" onclick="resetSession()">
                üîÑ Reset Sessione
            </button>
            <button class="control-btn" onclick="showOnlyDifficult()">
                üò∞ Solo Difficili
            </button>
            <button class="control-btn" onclick="openAddCardModal()">
                ‚ûï Aggiungi Nuova Carta
            </button>
        </div>

        <!-- Card Counter -->
        <div style="text-align: center; margin: 20px 0; font-size: 1.1rem;">
            Carta <span id="currentCard">1</span> di <span id="totalCards">0</span>
        </div>

        <!-- Flashcard Container -->
        <div id="flashcardContainer">
            <!-- Le flashcard verranno generate dinamicamente qui -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <h3>üéØ Pronto per iniziare!</h3>
            <p>Aggiungi le prime flashcard per il III anno di Neurologia</p>
            <button class="control-btn" onclick="openAddCardModal()">
                ‚ûï Aggiungi Prima Carta
            </button>
        </div>

        <!-- Session Complete -->
        <div id="sessionComplete" class="session-complete" style="display: none;">
            <div style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
            <h2 style="margin-bottom: 20px;">Sessione Completata!</h2>
            <p id="sessionSummary" style="font-size: 1.1rem; margin-bottom: 30px;"></p>
            <button class="control-btn" onclick="restartSession()">
                Inizia Nuova Sessione
            </button>
        </div>
    </div>

    <!-- Category Selection Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">Seleziona Argomenti da Studiare</h2>
            <div class="category-list" id="categoryList">
                <!-- Le categorie verranno generate dinamicamente -->
            </div>
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="control-btn" onclick="selectAllCategories()">
                    Seleziona Tutto
                </button>
                <button class="control-btn" onclick="deselectAllCategories()">
                    Deseleziona Tutto
                </button>
                <button class="control-btn" style="background: var(--primary); color: white;" onclick="applyCategoryFilter()">
                    Applica Filtro
                </button>
                <button class="control-btn" onclick="closeCategoryModal()">
                    Annulla
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Card Modal -->
    <div id="editModal" class="edit-modal">
        <div class="edit-content">
            <h3>Modifica Flashcard</h3>
            <input type="text" id="editCategory" class="edit-input" placeholder="Argomento (es. Epilessia, Stroke, Demenze...)">
            <textarea id="editQuestion" class="edit-input" placeholder="Domanda"></textarea>
            <textarea id="editAnswer" class="edit-input" placeholder="Risposta"></textarea>
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="control-btn" style="background: var(--success); color: white;" onclick="saveCardEdits()">
                    Salva Modifiche
                </button>
                <button class="control-btn" onclick="closeEditModal()">
                    Annulla
                </button>
            </div>
        </div>
    </div>
        
    <!-- Add Card Modal -->
    <div id="addCardModal" class="edit-modal">
        <div class="edit-content">
            <h3>Aggiungi Nuova Flashcard</h3>
            <input type="text" id="addCardCategory" class="edit-input" placeholder="Argomento (es. Epilessia, Stroke, Demenze...)">
            <textarea id="addCardQuestion" class="edit-input" placeholder="Domanda"></textarea>
            <textarea id="addCardAnswer" class="edit-input" placeholder="Risposta"></textarea>
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="control-btn" style="background: var(--success); color: white;" onclick="addNewCard()">
                    Aggiungi Carta
                </button>
                <button class="control-btn" onclick="closeAddCardModal()">
                    Annulla
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Keyboard Shortcuts -->
    <div class="keyboard-hints">
        <div class="keyboard-hint"><span class="key">Spazio</span> Gira carta</div>
        <div class="keyboard-hint"><span class="key">1</span> Facile</div>
        <div class="keyboard-hint"><span class="key">2</span> Medio</div>
        <div class="keyboard-hint"><span class="key">3</span> Difficile</div>
        <div class="keyboard-hint"><span class="key">E</span> Modifica</div>
    </div>

    <script>
        // Database delle flashcard neurologiche per il III anno
        const flashcardsData = [
           {
    category: "IGE - Definizione e Classificazione",
    question: "Qual √® la differenza tra Epilessie Generalizzate Idiopatiche (IGE) e Epilessie Generalizzate Genetiche (GGE) secondo la classificazione ILAE 2017?",
    answer: "Le IGE rappresentano un sottogruppo specifico delle GGE pi√π ampie.\n\nIGE (4 sindromi classiche):\n‚Ä¢ Epilessia Assenza Infantile (CAE)\n‚Ä¢ Epilessia Assenza Giovanile (JAE) \n‚Ä¢ Epilessia Mioclonica Giovanile (JME)\n‚Ä¢ Epilessia con sole Crisi Tonico-Cloniche Generalizzate\n\nCaratteristiche distintive IGE:\n‚Ä¢ Sindromi pi√π comuni nelle GGE\n‚Ä¢ Buona prognosi per controllo crisi\n‚Ä¢ Non evolvono in encefalopatie epilettiche\n‚Ä¢ Sovrapposizione clinica tra sindromi\n‚Ä¢ EEG simili con attivit√† di fondo normale",
    difficulty: 2,
    id: 1
},
{
    category: "IGE - Epidemiologia",
    question: "Descrivi l'epidemiologia generale delle IGE: prevalenza, et√† di esordio e tipi di crisi.",
    answer: "PREVALENZA: 1/5 di tutte le epilessie (20%)\n\nET√Ä DI ESORDIO: 3-25 anni (raramente fino a 40 anni)\n\nTIPI DI CRISI (una o combinazione):\n‚Ä¢ Assenze\n‚Ä¢ Miocloniche\n‚Ä¢ Tonico-cloniche\n‚Ä¢ Miocloniche-tonico-cloniche\n\nRISPOSTA AL TRATTAMENTO:\n‚Ä¢ 80% risponde agli anticrisi appropriati\n‚Ä¢ Valproato particolarmente efficace per CTCG\n‚Ä¢ ATTENZIONE: bloccanti canali Na+ (CBZ, OXC, PHT) esacerbano assenze e mioclonie",
    difficulty: 1,
    id: 2
},
{
    category: "IGE - Fattori Scatenanti",
    question: "Elenca i principali fattori scatenanti delle IGE e spiega il loro meccanismo.",
    answer: "FATTORI SCATENANTI COMUNI:\n\n‚Ä¢ **Stanchezza/Privazione del sonno**: Principale trigger, specie per JME\n‚Ä¢ **Stress**: Abbassa soglia epilettica\n‚Ä¢ **Stimolazione luminosa**: Fotosensibilit√† (fino al 90% in JME)\n‚Ä¢ **Iperventilazione**: Attiva scariche punta-onda\n‚Ä¢ **Alcol**: Consumo eccessivo o astinenza\n\nFARMACI TRIGGER:\n‚Ä¢ Difenidramina, pseudoefedrina\n‚Ä¢ Bupropione, tramadolo\n\nMECCANISMO:\n‚Üí Alterazione equilibrio eccitazione/inibizione\n‚Üí Destabilizzazione reti talamo-corticali\n‚Üí Facilitazione scariche punta-onda generalizzate",
    difficulty: 2,
    id: 3
},
{
    category: "CAE - Caratteristiche Cliniche",
    question: "Descrivi le caratteristiche cliniche, EEG e prognosi dell'Epilessia con Assenze dell'Infanzia (CAE).",
    answer: "**ESORDIO**: 4-10 anni\n\n**CRISI**: \n‚Ä¢ Assenze tipiche QUOTIDIANE\n‚Ä¢ Perdita COMPLETA di consapevolezza\n‚Ä¢ Durata: 3-20 secondi\n‚Ä¢ Provocate da iperventilazione\n\n**EEG**:\n‚Ä¢ Scariche punta-onda generalizzate 2.5-4 Hz\n‚Ä¢ Iperventilazione le provoca nell'87% casi non trattati\n‚Ä¢ Se HV per 3 min negativa ‚Üí esclude CAE\n\n**PROGNOSI**:\n‚Ä¢ Remissione nel 60% entro adolescenza\n‚Ä¢ Buona risposta a farmaci\n‚Ä¢ Etosuccimide = prima linea\n\n**ALERT**: Test SLC2A1 se esordio ‚â§3 anni o caratteristiche atipiche",
    difficulty: 2,
    id: 4
},
{
    category: "JAE - Caratteristiche Cliniche",
    question: "Quali sono le caratteristiche distintive dell'Epilessia con Assenze Giovanili (JAE) rispetto alla CAE?",
    answer: "**ESORDIO**: 9-13 anni (pi√π tardivo di CAE)\n\n**CRISI**:\n‚Ä¢ Assenze tipiche MENO frequenti (non quotidiane)\n‚Ä¢ Perdita di consapevolezza MENO completa\n‚Ä¢ CTCG presenti in >90% dei casi (differenza chiave da CAE)\n\n**EEG**:\n‚Ä¢ Scariche punta-onda generalizzate 3-5.5 Hz\n‚Ä¢ Frequenza leggermente pi√π alta di CAE\n\n**PROGNOSI**:\n‚Ä¢ Spesso sensibile a farmaci\n‚Ä¢ Terapia a VITA spesso richiesta\n‚Ä¢ Etosuccimide NON raccomandato come monoterapia per rischio CTCG\n\n**MANAGEMENT**: Valproato o lamotrigina preferiti",
    difficulty: 2,
    id: 5
},
{
    category: "JME - Caratteristiche Cliniche",
    question: "Descrivi la presentazione clinica, EEG e management dell'Epilessia Mioclonica Giovanile (JME).",
    answer: "**ESORDIO**: 10-24 anni\n\n**CRISI** (diagnosi richiede mioclonie):\n‚Ä¢ **Miocloniche**: OBBLIGATORIE, entro 1h dal risveglio\n‚Ä¢ **CTCG**: >90% dei pazienti\n‚Ä¢ **Assenze**: 1/3 dei casi\n\n**EEG**:\n‚Ä¢ Scariche punta-onda e polipunta-onda 3-5.5 Hz\n‚Ä¢ **Fotosensibilit√†**: fino al 90% (caratteristica distintiva)\n‚Ä¢ IPS pu√≤ indurre mioclonie, mioclonie palpebrali, CTCG\n\n**TRIGGERS SPECIFICI**:\n‚Ä¢ Privazione del sonno (principale)\n‚Ä¢ Risveglio mattutino\n‚Ä¢ Stimolazione fotica\n\n**PROGNOSI**: Disturbo a VITA, terapia lifelong\n**FARMACORESISTENZA**: ~1/3 dei pazienti",
    difficulty: 2,
    id: 6
},
{
    category: "GTCA - Epilessia Solo CTCG",
    question: "Quali sono le caratteristiche dell'Epilessia con Sole Crisi Tonico-Cloniche Generalizzate?",
    answer: "**ESORDIO**: 10-25 anni\n\n**CRISI**:\n‚Ä¢ **SOLO** Crisi Tonico-Cloniche Generalizzate (OBBLIGATORIE)\n‚Ä¢ Spesso entro 2h dal risveglio\n‚Ä¢ Provocate da privazione del sonno\n‚Ä¢ **ESCLUSIONE**: Assenze o mioclonie escludono diagnosi\n\n**EEG**:\n‚Ä¢ Scariche punta-onda o polipunta-onda 3-5.5 Hz\n‚Ä¢ Simile ad altre IGE ma senza correlati per assenze/mioclonie\n\n**TRIGGERS**:\n‚Ä¢ Privazione del sonno (principale)\n‚Ä¢ Risveglio mattutino\n‚Ä¢ Stress, alcol\n\n**PROGNOSI**:\n‚Ä¢ **Basso tasso di remissione**\n‚Ä¢ Trattamento a vita spesso richiesto\n‚Ä¢ Valproato prima scelta",
    difficulty: 2,
    id: 7
},
{
    category: "IGE - Genetica",
    question: "Descrivi la base genetica delle IGE, incluso il ruolo del gene SLC2A1.",
    answer: "**BASE GENETICA GENERALE**:\n‚Ä¢ **Ereditariet√† poligenica complessa** (principale)\n‚Ä¢ Supportata da studi su gemelli e famiglie\n‚Ä¢ CNVs nel 3% dei pazienti\n‚Ä¢ Continuum con disturbi neuropsichiatrici\n\n**CAUSE MONOGENICHE RARE**:\n‚Ä¢ Recettori GABA: GABRG2, GABRA1\n‚Ä¢ **SLC2A1**: codifica GLUT1 (trasportatore glucosio)\n\n**SINDROME GLUT1-DS** (mutazione SLC2A1):\n‚Ä¢ Deficit trasporto glucosio attraverso BEE\n‚Ä¢ **Test raccomandato**: CAE con esordio ‚â§3 anni\n‚Ä¢ **Alerts**: disabilit√† intellettiva, microcefalia, disturbi movimento, farmacoresistenza\n‚Ä¢ **Diagnosi**: ipoglicorrachia + analisi mutazionale\n‚Ä¢ **Terapia**: dieta chetogenica GOLD STANDARD",
    difficulty: 3,
    id: 8
},
{
    category: "IGE - EEG e Neuroimaging",
    question: "Quali sono i reperti EEG caratteristici delle IGE e quando √® indicato il neuroimaging?",
    answer: "**EEG CARATTERISTICO**:\n‚Ä¢ **Scariche punta-onda generalizzate (GSWD)**: 2.5-5.5 Hz\n‚Ä¢ Attivit√† di fondo NORMALE\n‚Ä¢ Attivazione con iperventilazione e stimolazione fotica\n‚Ä¢ EEG normale NON esclude IGE se clinica convincente\n\n**CARATTERISTICHE ATIPICHE**:\n‚Ä¢ IGE possono avere asimmetrie/aspetti focali\n‚Ä¢ Rischio diagnosi errata di epilessia focale\n\n**NEUROIMAGING**:\n‚Ä¢ **Tipicamente NORMALE** nelle IGE\n‚Ä¢ **Non indicato** nei casi tipici\n‚Ä¢ **Indicato se**: caratteristiche atipiche, farmacoresistenza, rallentamento focale persistente\n‚Ä¢ **JME**: sottili anomalie strutturali/funzionali pi√π frequenti\n\n**FISIOPATOLOGIA**: Ipersincronizzazione reti talamo-corticali",
    difficulty: 2,
    id: 9
},
{
    category: "IGE - Fotosensibilit√†",
    question: "Descrivi il ruolo della fotosensibilit√† nelle IGE, con particolare focus sulla JME.",
    answer: "**FOTOSENSIBILIT√Ä NELLA JME**:\n‚Ä¢ **Prevalenza**: 30-90% dei pazienti non trattati\n‚Ä¢ **Manifestazioni**: mioclonie, mioclonie palpebrali, CTCG\n‚Ä¢ **Trigger**: luci intermittenti, guida con sole tra alberi\n‚Ä¢ **Maggiore in**: pazienti donne\n\n**ALTRE IGE**:\n‚Ä¢ CAE, JAE, GTCA: fotosensibilit√† possibile ma meno frequente\n‚Ä¢ GSWD possono attivarsi con stimolazione fotica\n\n**DIAGNOSI DIFFERENZIALE**:\n‚Ä¢ **Epilessia con Mioclonie Palpebrali** (non IGE classica):\n  - Fotosensibilit√† CRITICA\n  - Crisi indotte da chiusura occhi, luce solare\n  - Parte delle GGE ma non delle 4 IGE classiche\n\n**MANAGEMENT**: Evitare trigger fotici, filtri solari",
    difficulty: 2,
    id: 10
},
{
    category: "IGE - Iperventilazione",
    question: "Qual √® il ruolo diagnostico dell'iperventilazione nelle IGE, specialmente nella CAE?",
    answer: "**RUOLO NELL'EEG**:\n‚Ä¢ Tecnica che innesca GSWD nelle IGE\n‚Ä¢ Manovra di attivazione standard\n\n**SPECIFICO PER CAE**:\n‚Ä¢ **87% dei pazienti non trattati**: HV provoca GSWD e assenze\n‚Ä¢ **Criterio di esclusione**: se HV per 3 min negativa ‚Üí CAE esclusa\n‚Ä¢ **Mandatoria** per confermare diagnosi\n\n**CARATTERISTICHE EEG INDOTTE**:\n‚Ä¢ Scariche punta-onda generalizzate regolari a 3 Hz (2.5-4 Hz)\n‚Ä¢ Correlato clinico: assenza con perdita completa consapevolezza\n‚Ä¢ Interruzione attivit√†, sguardo fisso\n\n**ALTRE IGE**:\n‚Ä¢ Possibile attivazione ma meno specifica\n‚Ä¢ Utilizzata come procedura standard in tutte le IGE\n\n**MECCANISMO**: Ipocarbia ‚Üí alterazione eccitabilit√† neuronale",
    difficulty: 2,
    id: 11
},
{
    category: "IGE - Criteri di Esclusione",
    question: "Elenca i principali criteri di esclusione per la diagnosi di IGE.",
    answer: "**TIPI DI CRISI ESCLUDENTI**:\n‚Ä¢ Crisi focali\n‚Ä¢ CTCG atipiche, assenze atipiche\n‚Ä¢ Crisi toniche, atoniche, mioclonico-atoniche\n‚Ä¢ Spasmi epilettici\n\n**REPERTI EEG ESCLUDENTI**:\n‚Ä¢ Attivit√† epilettiforme focale CONSISTENTE\n‚Ä¢ Rallentamenti focali persistenti (non post-critici)\n‚Ä¢ Rallentamento diffuso di fondo (non da farmaci)\n‚Ä¢ 'Incantesimi' senza correlato EEG\n\n**ASPETTI COGNITIVI**:\n‚Ä¢ Disabilit√† intellettiva moderata-severa\n‚Ä¢ (DI lieve: richiede ulteriori indagini)\n\n**NEUROIMAGING**:\n‚Ä¢ Anomalie rilevanti con lesione causale\n‚Ä¢ IGE = neuroimaging strutturale normale per definizione\n\n**PRINCIPIO**: IGE sono epilessie 'benigne' senza substrato lesionale",
    difficulty: 2,
    id: 12
},
{
    category: "IGE - Comorbidit√†",
    question: "Quali sono le principali comorbidit√† associate alle IGE?",
    answer: "**DISTURBI NEUROPSICHIATRICI** (frequenti):\n‚Ä¢ Disturbi dell'umore (depressione, ansia)\n‚Ä¢ ADHD (Deficit Attenzione/Iperattivit√†)\n‚Ä¢ Disturbi dell'apprendimento\n\n**DISABILIT√Ä INTELLETTIVA**:\n‚Ä¢ **NON tipicamente associate** a DI o DEE\n‚Ä¢ DI lieve: possibile, richiede indagini ulteriori\n‚Ä¢ DI moderata-severa: criterio di esclusione\n\n**DISTURBI DEL SONNO**:\n‚Ä¢ Architettura del sonno alterata\n‚Ä¢ Ritmi cerebrali interrotti da attivit√† epilettiforme\n‚Ä¢ Privazione sonno e risveglio: trigger per crisi\n\n**IMPATTO CLINICO**:\n‚Ä¢ Comorbidit√† psichiatriche associate a farmacoresistenza\n‚Ä¢ Necessit√† gestione multidisciplinare\n‚Ä¢ Valutazione neuropsicologica raccomandata",
    difficulty: 2,
    id: 13
},
{
    category: "IGE - Terapia Farmacologica",
    question: "Quali sono i farmaci di prima linea per le IGE e quelli da evitare?",
    answer: "**FARMACI DI PRIMA LINEA**:\n\n‚Ä¢ **Valproato**: Gold standard per CTCG, assenze, mioclonie\n  - ATTENZIONE: teratogeno, cautela in donne fertili\n\n‚Ä¢ **Etosuccimide**: Prima scelta per CAE (solo assenze)\n  - Non per JAE (rischio CTCG)\n\n‚Ä¢ **Levetiracetam**: Approvato JME e CTCG\n  - Prima linea donne fertili (basso rischio teratogeno)\n\n‚Ä¢ **Lamotrigina**: CTCG e assenze\n  - Prima linea donne fertili\n\n**FARMACI DA EVITARE**:\n‚Ä¢ **Bloccanti canali Na+**: CBZ, OXC, PHT, eslicarbazepina\n  ‚Üí Esacerbano assenze e mioclonie\n  ‚Üí Rischio stato epilettico\n‚Ä¢ **Agenti GABAergici**: tiagabina, vigabatrina\n‚Ä¢ **Perampanel**: cautela (non efficace su mioclonie/assenze)",
    difficulty: 2,
    id: 14
},
{
    category: "IGE - Considerazioni Speciali Donne",
    question: "Quali sono le considerazioni terapeutiche specifiche per le donne in et√† fertile con IGE?",
    answer: "**CONSULENZA PRECONCEZIONALE OBBLIGATORIA**:\n\n**RISCHI TERATOGENI** (dose-dipendenti):\n‚Ä¢ **Alto rischio**: Valproato (evitare se possibile)\n‚Ä¢ **Basso rischio**: Levetiracetam, Lamotrigina\n\n**INTERAZIONI CONTRACCETTIVE**:\n‚Ä¢ Alcuni ASM inducono enzimi epatici\n‚Ä¢ Riducono efficacia contraccettivi ormonali\n‚Ä¢ Necessaria consulenza contraccettiva\n\n**SUPPLEMENTAZIONE**:\n‚Ä¢ **Folato**: 1-4 mg/die per TUTTE le donne fertili con ASM\n‚Ä¢ Riduce rischio difetti tubo neurale\n\n**FARMACI PREFERITI**:\n‚Ä¢ **Prima linea**: Levetiracetam, Lamotrigina\n‚Ä¢ Efficaci e sicuri in gravidanza\n‚Ä¢ Buon controllo crisi con basso rischio fetale\n\n**MONITORAGGIO**: Livelli farmaco in gravidanza",
    difficulty: 3,
    id: 15
},
{
    category: "IGE - GLUT1 e Dieta Chetogenica",
    question: "Descrivi il ruolo della dieta chetogenica nelle IGE, specialmente nella sindrome GLUT1-DS.",
    answer: "**SINDROME GLUT1-DS** (mutazione SLC2A1):\n‚Ä¢ **Dieta chetogenica**: GOLD STANDARD (prima linea)\n‚Ä¢ **Meccanismo**: corpi chetonici come fonte energetica alternativa\n‚Ä¢ **Efficacia**: massima nel bypassare deficit trasporto glucosio\n‚Ä¢ **Timing**: iniziare precocemente per sviluppo neurologico ottimale\n\n**DIETA ATKINS MODIFICATA (MAD)**:\n‚Ä¢ Variante meno restrittiva\n‚Ä¢ Simile efficacia, migliore tollerabilit√†\n‚Ä¢ Valida alternativa se compliance problematica\n‚Ä¢ **Aggiunta MCT**: ottimizza supporto energetico astrociti\n\n**ALTRE IGE FARMACORESISTENTI**:\n‚Ä¢ Efficacia inferiore rispetto a GLUT1-DS\n‚Ä¢ Opzione valida nei casi resistenti\n‚Ä¢ Riduzione significativa frequenza crisi\n\n**ASM IN GLUT1-DS**: Generalmente POCO EFFICACI\n**PRINCIPIO**: Deficit metabolico richiede approccio metabolico",
    difficulty: 3,
    id: 16
},
{
    category: "IGE - Gestione Stile di Vita",
    question: "Quali modifiche dello stile di vita sono cruciali nella gestione delle IGE?",
    answer: "**IGIENE DEL SONNO** (prioritaria):\n‚Ä¢ Orari sonno regolari\n‚Ä¢ Evitare privazione del sonno (principale trigger)\n‚Ä¢ Investigare abitudini sonno ad ogni visita\n\n**GESTIONE STRESS**:\n‚Ä¢ Mindfulness, rilassamento muscolare progressivo\n‚Ä¢ Yoga, biofeedback\n‚Ä¢ Terapia cognitivo-comportamentale\n‚Ä¢ Migliora controllo crisi E comorbidit√† psichiatriche\n\n**MODERAZIONE ALCOL**:\n‚Ä¢ Evitare consumo eccessivo (>2 drink/occasione)\n‚Ä¢ Astinenza anche scatenante\n‚Ä¢ Consulenza per disturbi da uso alcol\n\n**TRIGGER SPECIFICI**:\n‚Ä¢ **Fotosensibilit√†**: occhiali scuri, evitare luci intermittenti\n‚Ä¢ **Farmaci**: attenzione a difenidramina, pseudoefedrina\n\n**ADERENZA TERAPEUTICA**:\n‚Ä¢ Cruciale mantenere livelli ASM\n‚Ä¢ Causa comune crisi 'breakthrough' in adolescenti",
    difficulty: 2,
    id: 17
},
{
    category: "IGE - Farmacoresistenza e Terapie Avanzate",
    question: "Come gestire la farmacoresistenza nelle IGE e quali sono le opzioni terapeutiche avanzate?",
    answer: "**EPIDEMIOLOGIA FARMACORESISTENZA**:\n‚Ä¢ ~1/3 pazienti JME presenta crisi continue\n‚Ä¢ Associata a comorbidit√† psichiatriche\n‚Ä¢ Fattori clinici specifici predittivi\n\n**TERAPIE DIETETICHE**:\n‚Ä¢ **Dieta chetogenica**: efficace in IGE farmacoresistenti\n‚Ä¢ **Dieta Atkins modificata**: alternativa meno restrittiva\n‚Ä¢ Particolare efficacia se mutazione SLC2A1\n\n**NEUROMODULAZIONE** (evidenze limitate):\n‚Ä¢ **VNS** (Stimolazione Nervo Vago)\n‚Ä¢ **DBS** (Stimolazione Cerebrale Profonda)\n‚Ä¢ **RNS** (Neurostimolazione Responsiva)\n‚Ä¢ Solo serie open-label, no RCT definitivi\n\n**VALUTAZIONE**:\n‚Ä¢ Confermare diagnosi IGE\n‚Ä¢ Escludere non-aderenza\n‚Ä¢ Ottimizzare gestione stile di vita\n‚Ä¢ Considerare comorbidit√† psichiatriche",
    difficulty: 3,
    id: 18
},
{
    category: "IGE - SUDEP",
    question: "Qual √® il rischio di SUDEP nelle IGE e quali sono i fattori di rischio?",
    answer: "**EPIDEMIOLOGIA SUDEP**:\n‚Ä¢ Tassi SIMILI tra epilessia focale e IGE\n‚Ä¢ Epilessia focale pi√π spesso farmacoresistente\n‚Ä¢ IGE non sono 'benigne' per rischio SUDEP\n\n**PRINCIPALE FATTORE DI RISCHIO**:\n‚Ä¢ **CTCG non controllate** (fattore principale)\n‚Ä¢ Rischio maggiore con crisi generalizzate\n\n**PARADOSSO DEI PAZIENTI CONTROLLATI**:\n‚Ä¢ Pazienti farmaco-sensibili a rischio dopo crisi 'breakthrough'\n‚Ä¢ **Meccanismo**: libert√† da crisi prolungata riduce risposte adattative\n‚Ä¢ Sistema cardiovascolare/respiratorio meno 'allenato'\n\n**PREVENZIONE**:\n‚Ä¢ Controllo ottimale CTCG\n‚Ä¢ Aderenza terapeutica\n‚Ä¢ Gestione fattori scatenanti\n‚Ä¢ Educazione paziente/famiglia\n\n**COUNSELING**: Informare su rischi senza allarmismo eccessivo",
    difficulty: 2,
    id: 19
},
{
    category: "IGE - Diagnosi Differenziale",
    question: "Quali sono i principali elementi di diagnosi differenziale tra le 4 sindromi IGE classiche?",
    answer: "**ET√Ä DI ESORDIO**:\n‚Ä¢ **CAE**: 4-10 anni (pi√π precoce)\n‚Ä¢ **JAE**: 9-13 anni  \n‚Ä¢ **JME**: 10-24 anni\n‚Ä¢ **GTCA**: 10-25 anni\n\n**TIPI DI CRISI**:\n‚Ä¢ **CAE**: SOLO assenze quotidiane\n‚Ä¢ **JAE**: assenze + CTCG (>90%)\n‚Ä¢ **JME**: mioclonie (obbligatorie) + CTCG (>90%) + assenze (1/3)\n‚Ä¢ **GTCA**: SOLO CTCG (assenze/mioclonie escludono)\n\n**CARATTERISTICHE DISTINTIVE**:\n‚Ä¢ **CAE**: HV attiva assenze (87%), remissione 60%\n‚Ä¢ **JAE**: assenze meno frequenti, meno complete\n‚Ä¢ **JME**: fotosensibilit√† (90%), mattutine, lifelong\n‚Ä¢ **GTCA**: basso tasso remissione, lifelong\n\n**OVERLAP**: Possibile evoluzione tra sindromi con l'et√†",
    difficulty: 3,
    id: 20
},
{
    category: "IGE - Fisiopatologia",
    question: "Descrivi la fisiopatologia delle IGE: reti neurali coinvolte e meccanismi delle scariche punta-onda.",
    answer: "**RETI TALAMO-CORTICALI**:\n‚Ä¢ **Ipersincronizzazione** delle reti talamo-corticali\n‚Ä¢ Genera le GSWD (scariche punta-onda generalizzate)\n‚Ä¢ Coinvolge circuiti specifici, NON tutte le cellule cerebrali\n\n**MECCANISMO SCARICHE PUNTA-ONDA**:\n‚Ä¢ **Frequenza caratteristica**: 2.5-5.5 Hz\n‚Ä¢ Sincronizzazione anomala neuroni corticali\n‚Ä¢ Mediata da circuiti talamo-corticali\n‚Ä¢ Attivazione da iperventilazione, fotostimolazione\n\n**CORRELATO CLINICO**:\n‚Ä¢ **Punta**: depolarizzazione sincrona (correlato EEG crisi)\n‚Ä¢ **Onda**: iperpolarizzazione (fine crisi)\n‚Ä¢ Durata determina manifestazione clinica\n\n**FATTORI MODULANTI**:\n‚Ä¢ Sonno/risveglio: alterano sincronizzazione\n‚Ä¢ Stress: modifica eccitabilit√†\n‚Ä¢ Farmaci: modulano trasmissione GABA/glutammato\n\n**TARGET TERAPEUTICI**: Stabilizzazione reti talamo-corticali",
    difficulty: 3,
    id: 21
},
            {
    category: "Parkinson - Trattamento Iniziale",
    question: "Qual √® la terapia iniziale suggerita per la maggior parte dei pazienti con Malattia di Parkinson e perch√© si preferisce la formulazione IR alla CR?",
    answer: "**TERAPIA INIZIALE**: Levodopa a rilascio immediato (IR)\n‚Ä¢ Carbidopa-levodopa IR (es. Sinemet)\n‚Ä¢ Spesso meglio tollerata, specie negli anziani\n\n**PERCH√â NON CR INIZIALMENTE**:\n‚Ä¢ **Assorbimento incompleto**: CR richiede 70% dose superiore per effetto simile\n‚Ä¢ **Effetto ridotto/lento**: picco clinico inferiore, raggiunge cervello pi√π lentamente\n‚Ä¢ **Difficolt√† valutazione risposta**: cinetica lenta complica titolazione iniziale\n\n**QUANDO USARE CR**:\n‚Ä¢ Sintomi notturni/mattutini (wearing off)\n‚Ä¢ Intolleranza effetti collaterali IR (nausea, sonnolenza)\n‚Ä¢ Fasi avanzate (uso limitato per onset imprevedibile)",
    difficulty: 2,
    id: 22
},
{
    category: "Parkinson - Gestione Effetti Collaterali Iniziali",
    question: "Come gestire la nausea e altri effetti collaterali iniziali della levodopa? Qual √® il ruolo della carbidopa?",
    answer: "**EFFETTI COLLATERALI INIZIALI**:\n‚Ä¢ Nausea (comune), sonnolenza, vertigini, mal di testa\n‚Ä¢ **Gestione**: dosi basse iniziali, titolazione lenta\n‚Ä¢ **Raccomandazione**: assumere CON PASTO all'inizio\n\n**RUOLO CARBIDOPA**:\n‚Ä¢ Inibitore decarbossilasi periferica\n‚Ä¢ Blocca conversione levodopa‚Üídopamina in periferia\n‚Ä¢ Previene effetti dopaminergici sistemici (nausea/vomito)\n\n**CAMBIO STRATEGIA IN FASE AVANZATA**:\n‚Ä¢ Con wearing off ‚Üí assumere A STOMACO VUOTO\n‚Ä¢ Proteine competono con levodopa per assorbimento\n‚Ä¢ 30-60 min prima pasto o 60-90 min dopo\n‚Ä¢ **Dieta Redistribuzione Proteica**: concentrare proteine a cena",
    difficulty: 2,
    id: 23
},
{
    category: "Parkinson - Dopamino Agonisti",
    question: "Quando considerare i dopamino agonisti come terapia iniziale e quali sono i principali rischi/benefici?",
    answer: "**INDICAZIONI DA**:\n‚Ä¢ **Pazienti <50 anni**: alto rischio discinesia\n‚Ä¢ **Beneficio**: minor rischio complicanze motorie vs levodopa\n‚Ä¢ **Monoterapia iniziale**: alternativa alla levodopa\n\n**CONTROINDICAZIONI**:\n‚Ä¢ Deterioramento cognitivo preesistente\n‚Ä¢ Allucinazioni preesistenti\n‚Ä¢ Adulti anziani (>rischio neuropsichiatrico)\n\n**EFFETTI COLLATERALI vs LEVODOPA**:\n‚Ä¢ **Pi√π frequenti**: edema, sonnolenza, stitichezza, vertigini, allucinazioni\n\n**DISTURBI CONTROLLO IMPULSI (ICBDs)**:\n‚Ä¢ **Incidenza**: 50% cumulativa a 5 anni\n‚Ä¢ **Manifestazioni**: gioco d'azzardo, shopping, ipersessualit√†, alimentazione compulsiva\n‚Ä¢ **Fattori rischio**: maschi, giovani, storia ICBDs, disturbi umore\n‚Ä¢ **Gestione**: tapering graduale (evitare DAWS)",
    difficulty: 3,
    id: 24
},
{
    category: "Parkinson - Inibitori MAO-B",
    question: "Quali sono le caratteristiche e indicazioni degli inibitori MAO-B come terapia iniziale?",
    answer: "**INDICAZIONI**:\n‚Ä¢ Pazienti qualsiasi et√† con sintomi lievi\n‚Ä¢ Preferenza per monosomministrazione\n‚Ä¢ Necessit√† solo beneficio modesto\n\n**VANTAGGI**:\n‚Ä¢ **Convenienza**: 1-2 volte/die\n‚Ä¢ **Tollerabilit√† generale** buona\n‚Ä¢ **Potenza bassa**: ideali per sintomi non interferenti\n\n**LIMITAZIONI**:\n‚Ä¢ **Efficacia inferiore** a levodopa\n‚Ä¢ **60% pazienti** richieder√† levodopa aggiuntiva entro 2-3 anni\n\n**FARMACI DISPONIBILI**:\n‚Ä¢ **Rasagilina**: 0.5-1 mg una volta/die\n‚Ä¢ **Selegilina**: 5 mg 2 volte/die (colazione/pranzo)\n‚Ä¢ **Safinamide**: 50 mg una volta/die\n\n**EFFETTI COLLATERALI**: nausea, mal di testa, confusione, allucinazioni, cadute, insonnia",
    difficulty: 2,
    id: 25
},
{
    category: "Parkinson - Wearing Off",
    question: "Descrivi il fenomeno del 'wearing off': fisiopatologia, caratteristiche cliniche e strategie di gestione.",
    answer: "**DEFINIZIONE**: Riemersione sintomi parkinsoniani quando effetto levodopa si riduce\n‚Ä¢ **Timing**: 3-4 ore dopo dose\n‚Ä¢ **Frequenza**: 50% dopo 5-10 anni, >60% dopo 10 anni\n\n**FISIOPATOLOGIA**:\n‚Ä¢ **Perdita capacit√† stoccaggio**: degenerazione neuroni nigrostriatali\n‚Ä¢ **Emivita breve levodopa**: ~90 minuti\n‚Ä¢ **Stimolazione pulsatile**: senza buffer neuronale\n\n**GESTIONE TERAPEUTICA**:\n1. **Aggiustamento dose/intervallo**: ‚Üëdose o frazionamento\n2. **Terapie aggiuntive**:\n   - COMT inibitori (entacapone, opicapone)\n   - Agonisti dopamina\n   - MAO-B inibitori\n3. **Formulazioni long-acting**: CR serale, ER capsule\n4. **Aggiustamenti dietetici**: stomaco vuoto, evitare proteine",
    difficulty: 3,
    id: 26
},
{
    category: "Parkinson - Discinesia da Picco",
    question: "Come gestire la discinesia da picco di dose? Qual √® la strategia di prima linea?",
    answer: "**CARATTERISTICHE**:\n‚Ä¢ **Timing**: 30-90 min dopo dose levodopa\n‚Ä¢ **Natura**: coreiforme, in stato 'on'\n‚Ä¢ **Dose-dipendente**: prevedibile e reversibile\n‚Ä¢ **Meccanismo**: ipersensibilit√† recettori + eccesso dopamina\n\n**STRATEGIA PRIMA LINEA**:\n‚Ä¢ **Riduzione dose levodopa**: ‚Üìpicco concentrazione plasmatica\n‚Ä¢ **Frazionamento dose**: + dosi piccole, - intervalli\n‚Ä¢ **Obiettivo**: mantener nella 'finestra terapeutica'\n\n**RISCHI FRAZIONAMENTO**:\n‚Ä¢ Dosi troppo basse ‚Üí fallimento soglia 'on' ‚Üí ‚Üëtempo 'off'\n\n**SECONDA LINEA - AMANTADINA**:\n‚Ä¢ **Efficacia**: riduzione 25-50% vs placebo\n‚Ä¢ **Quando**: se riduzione dose insufficiente\n\n**ATTENZIONE COMT inibitori**: possono peggiorare discinesia ‚Üí ridurre levodopa 10-30%",
    difficulty: 3,
    id: 27
},
{
    category: "Parkinson - Amantadina Avanzata",
    question: "Qual √® il ruolo specifico dell'amantadina nella MP avanzata: meccanismo, indicazioni e precauzioni?",
    answer: "**INDICAZIONI PRINCIPALI**:\n‚Ä¢ **Discinesia**: riduzione 25-50% punteggi vs placebo\n‚Ä¢ **Tempo 'off'**: miglioramento 0.9 ore vs placebo\n‚Ä¢ **Tremore prominente**: particolarmente utile\n\n**MECCANISMO D'AZIONE**:\n‚Ä¢ ‚Üërilascio dopamina, ‚Üìricaptazione\n‚Ä¢ **Antagonista NMDA**: riduce neurotrasmissione glutammato eccessiva\n\n**FORMULAZIONI**:\n‚Ä¢ **IR**: uso immediato\n‚Ä¢ **ER**: 274 mg al momento coricarsi\n\n**EFFETTI COLLATERALI**:\n‚Ä¢ **Centrali**: confusione, allucinazioni, incubi (specie anziani)\n‚Ä¢ **Periferici**: livedo reticularis, edema malleolare\n\n**PRECAUZIONI IMPORTANTI**:\n‚Ä¢ **ECG obbligatorio**: basale, 1-3 settimane, poi annuale\n‚Ä¢ **QTc >420 ms o ‚Üë>60 ms**: escludere trattamento\n‚Ä¢ **Insufficienza renale**: aggiustare dose\n‚Ä¢ **Ultima dose**: non dopo le 16h",
    difficulty: 3,
    id: 28
},
{
    category: "Parkinson - Sindrome Parkinsonismo-Iperpiressia",
    question: "Descrivi la sindrome parkinsonismo-iperpiressia: cause, caratteristiche cliniche e gestione.",
    answer: "**DEFINIZIONE**: Condizione grave da interruzione/riduzione drastica farmaci anti-Parkinson\n‚Ä¢ **Farmaci coinvolti**: levodopa, agonisti dopamina, (raro) amantadina\n‚Ä¢ **Contesto**: ospedaliero (NPO), chirurgia, malattia grave\n\n**CARATTERISTICHE CLINICHE**:\n‚Ä¢ **Simile a**: Sindrome Neurolettica Maligna\n‚Ä¢ **Manifestazioni**: rigidit√† grave, ipertermia\n‚Ä¢ **Gravit√†**: potenzialmente fatale, decessi riportati\n\n**FISIOPATOLOGIA**:\n‚Ä¢ Privazione dopaminergica acuta\n‚Ä¢ Perdita controllo termoregolazione\n‚Ä¢ Rigidit√† muscolare estrema\n\n**PREVENZIONE**:\n‚Ä¢ **Mai interrompere bruscamente** farmaci anti-Parkinson\n‚Ä¢ **Attenzione ospedaliera**: mantenere dosaggi/timing\n‚Ä¢ **Pazienti moderato-gravi**: particolare rischio\n\n**TRATTAMENTO**:\n‚Ä¢ **Reintroduzione immediata** farmaci pre-sindrome\n‚Ä¢ **Vie alternative**: orale, sondino nasogastrico\n‚Ä¢ **Supporto intensivo**: terapia intensiva per ipertermia/rigidit√†",
    difficulty: 3,
    id: 29
},
{
    category: "Parkinson - DAWS",
    question: "Cos'√® la Sindrome da Astinenza da Agonisti della Dopamina (DAWS) e come prevenirla?",
    answer: "**DEFINIZIONE**: Sindrome astinenza da sospensione improvvisa agonisti dopamina\n‚Ä¢ **Frequenza**: 8-19% pazienti che sospendono DA\n‚Ä¢ **Simile a**: astinenza cocaina/anfetamine\n\n**CARATTERISTICHE CLINICHE**:\n‚Ä¢ **Neuropsichiatrici**: ansia, attacchi panico, depressione\n‚Ä¢ **Fisici**: dolore, sudorazione, nausea, fatica, vertigini\n‚Ä¢ **Comportamentali**: craving del farmaco\n\n**ASPETTI DISTINTIVI**:\n‚Ä¢ **Refrattaria** ad altri antiparkinsoniani (inclusa levodopa)\n‚Ä¢ **Unico trattamento efficace**: ripresa agonista dopamina\n‚Ä¢ **Fenomeno distinto** da sindrome parkinsonismo-iperpiressia\n\n**PREVENZIONE CRUCIALE**:\n‚Ä¢ **Mai cessazione brusca** agonisti dopamina\n‚Ä¢ **Tapering graduale**: riduzioni modeste ogni 2 settimane\n‚Ä¢ **Beneficio doppio**: evita DAWS + permette valutazione risposta levodopa aggiuntiva\n\n**GESTIONE**: lenta riduzione scalare, supporto sintomatico",
    difficulty: 2,
    id: 30
},
{
    category: "Parkinson - Terapie di Salvataggio",
    question: "Quando sono indicate le terapie di salvataggio e quali sono le opzioni disponibili?",
    answer: "**INDICAZIONI**:\n‚Ä¢ Periodi 'off' improvvisi, imprevedibili, prolungati\n‚Ä¢ **Nonostante**: ottimizzazione terapia orale + aggiustamenti dietetici\n‚Ä¢ **Obiettivo**: uscita rapida da stato acinetico\n\n**APOMORFINA SOTTOCUTANEA**:\n‚Ä¢ **Potente agonista DA** per somministrazione SC/sublinguale\n‚Ä¢ **Usi specifici**:\n  - Periodi 'off' improvvisi\n  - Stati 'off' mattutini precoci\n  - Ponte per accorciare wearing off\n‚Ä¢ **Onset**: rapido (10 minuti)\n\n**ALTRE OPZIONI**:\n‚Ä¢ **Levodopa inalata**: miglioramento in 5 minuti\n‚Ä¢ **Apomorfina sublinguale**: non sempre disponibile\n\n**MODALIT√Ä APOMORFINA**:\n1. **Rescue therapy**: iniezioni on-demand\n2. **Infusione continua**: SC per fluttuazioni refrattarie\n\n**GESTIONE NAUSEA**:\n‚Ä¢ **Premedicazione**: trimetobenzamide o domperidone\n‚Ä¢ **Tolleranza**: molti pazienti non necessitano premedicazione long-term",
    difficulty: 3,
    id: 31
},
{
    category: "Parkinson - Gestione Dietetica Avanzata",
    question: "Come gestire l'interazione cibo-farmaco nelle fasi avanzate del Parkinson? Descrivi le strategie dietetiche specifiche.",
    answer: "**PROBLEMA FISIOPATOLOGICO**:\n‚Ä¢ **Competizione**: amminoacidi neutri vs levodopa\n‚Ä¢ **Siti competizione**: assorbimento duodenale + passaggio barriera ematoencefalica\n‚Ä¢ **Conseguenze**: ‚Üìbeneficio clinico, risposte ritardate, fallimento 'on'\n\n**STRATEGIA A - STOMACO VUOTO**:\n‚Ä¢ **Timing**: 30-60 min prima pasto O 60-90 min dopo\n‚Ä¢ **Evitare proteine** al momento somministrazione\n‚Ä¢ **Indicazione**: fluttuazioni motorie standard\n\n**STRATEGIA B - DIETA REDISTRIBUZIONE PROTEICA (PRD)**:\n‚Ä¢ **Principio**: concentrare proteine giornaliere a CENA\n‚Ä¢ **Indicazioni**: fluttuazioni complesse, fallimenti dose, 'off' imprevedibili\n‚Ä¢ **Benefici**: dimostrati in piccoli studi\n‚Ä¢ **Limitazioni**: scomodit√†, scarsa aderenza long-term\n‚Ä¢ **Necessario**: consulenza nutrizionista\n\n**CAMBIO PARADIGMA**: Early disease (con cibo) ‚Üí Advanced disease (stomaco vuoto)",
    difficulty: 3,
    id: 32
},
{
    category: "Parkinson - COMT Inibitori e Interazioni",
    question: "Qual √® il ruolo degli inibitori COMT nella terapia del Parkinson e quali precauzioni adottare?",
    answer: "**RUOLO TERAPEUTICO**:\n‚Ä¢ **Indicazione principale**: wearing off\n‚Ä¢ **Meccanismo**: prolungano effetto levodopa\n‚Ä¢ **Beneficio**: riducono tempo 'off'\n\n**FARMACI DISPONIBILI**:\n‚Ä¢ **Entacapone**: pi√π comune\n‚Ä¢ **Opicapone**: formulazione pi√π recente\n\n**PRECAUZIONE CRUCIALE**:\n‚Ä¢ **Rischio discinesia**: ‚Üëstimolazione dopaminergica totale\n‚Ä¢ **Prassi standard**: ridurre levodopa 10-30% quando si aggiunge COMT inibitore\n‚Ä¢ **Specialmente in**: pazienti con discinesia preesistente\n\n**MECCANISMO INTERAZIONE**:\n‚Ä¢ COMT inibitori + levodopa = ‚Üëdisponibilit√† dopamina\n‚Ä¢ Pu√≤ causare/peggiorare discinesia da picco\n‚Ä¢ Possibili altri effetti dopaminergici\n\n**STRATEGIA SICURA**:\n1. Valutare discinesia preesistente\n2. Ridurre dose levodopa preventivamente\n3. Monitorare risposta clinica\n4. Aggiustare secondo necessit√†\n\n**STESSO PRINCIPIO**: vale per tutti farmaci adiuvanti (DA, MAO-B inibitori)",
    difficulty: 2,
    id: 33
},
{
    category: "Parkinson - Monitoraggio Specialistico",
    question: "Quali sono i principali parametri di monitoraggio specialistico nella terapia del Parkinson?",
    answer: "**MONITORAGGIO ECG (Amantadina)**:\n‚Ä¢ **Tempistica**: basale, 1-3 settimane, aumenti dose (2 sett), poi annuale\n‚Ä¢ **Parametri critici**:\n  - QTc basale >420 ms ‚Üí escludere\n  - ‚ÜëQTc >60 ms durante trattamento ‚Üí escludere\n  - QTc >480 ms durante trattamento ‚Üí escludere\n  - Onde U apprezzabili ‚Üí escludere\n‚Ä¢ **Rischio**: tachicardia ventricolare torsione di punta\n\n**VALUTAZIONE DISCINESIA**:\n‚Ä¢ **Scale standardizzate**: riduzione 25-50% vs placebo (amantadina)\n‚Ä¢ **Timing onset**: 30-90 min post-dose\n‚Ä¢ **Correlazione dose-effetto**: per strategie riduzione\n\n**MONITORAGGIO ICBDs** (Agonisti DA):\n‚Ä¢ **Screening regolare**: comportamenti compulsivi\n‚Ä¢ **Fattori rischio**: maschi, giovani, storia precedente\n‚Ä¢ **Educazione paziente/famiglia**: riconoscimento precoce\n\n**FUNZIONE RENALE** (Amantadina):\n‚Ä¢ **Clearance creatinina <50 mL/min**: aggiustamento dose\n‚Ä¢ **Monitoraggio continuo**: tossicit√† dose-dipendente",
    difficulty: 2,
    id: 34
},
{
    category: "Parkinson - Principi Farmacologici Avanzati",
    question: "Illustra i principi di stimolazione dopaminergica continua vs pulsatile e le implicazioni terapeutiche.",
    answer: "**STIMOLAZIONE FISIOLOGICA vs PATOLOGICA**:\n‚Ä¢ **Fisiologica**: rilascio dopamina costante dai neuroni sani\n‚Ä¢ **MP avanzata**: perdita capacit√† buffer ‚Üí stimolazione pulsatile\n\n**CONSEGUENZE STIMOLAZIONE PULSATILE**:\n‚Ä¢ **Wearing off**: effetto riflette cinetica farmaco (90 min)\n‚Ä¢ **Discinesia**: ipersensibilit√† recettoriale da stimolazione intermittente\n‚Ä¢ **Fluttuazioni motorie**: perdita controllo fine\n\n**STRATEGIE STIMOLAZIONE CONTINUA**:\n1. **Frazionamento dose**: ‚Üìsingola dose, ‚Üëfrequenza\n2. **Formulazioni long-acting**: CR, ER capsule\n3. **Terapie aggiuntive**: COMT inibitori, DA, MAO-B inibitori\n4. **Device-assisted**: apomorfina continua, DBS, duodopa\n\n**FINESTRA TERAPEUTICA**:\n‚Ä¢ **Soglia inferiore**: livello minimo per effetto 'on'\n‚Ä¢ **Soglia superiore**: livello massimo senza discinesia\n‚Ä¢ **Obiettivo**: mantenere livelli in range terapeutico\n‚Ä¢ **Sfida**: finestra si restringe con progressione malattia",
    difficulty: 3,
    id: 35
},
{
    category: "Parkinson - Criteri Diagnostici Prerequisiti",
    question: "Qual √® il prerequisito essenziale per applicare i criteri MDS-PD e come si definisce il parkinsonismo?",
    answer: "**PREREQUISITO FONDAMENTALE**: Diagnosi di parkinsonismo\n\n**DEFINIZIONE PARKINSONISMO**:\n‚Ä¢ **Bradicinesia** (obbligatoria) + almeno uno tra:\n  - Tremore a riposo\n  - Rigidit√†\n‚Ä¢ Caratteristiche chiaramente dimostrabili\n‚Ä¢ Non attribuibili a fattori confondenti\n\n**SEDE ANATOMICA**:\n‚Ä¢ **Bradicinesia**: deve essere documentata a livello ARTI\n‚Ä¢ Altre manifestazioni: generalmente arti ma possibile estensione\n\n**IMPORTANZA CLINICA**:\n‚Ä¢ **Step 1**: confermare parkinsonismo\n‚Ä¢ **Step 2**: determinare se causa = Malattia di Parkinson\n‚Ä¢ **Senza parkinsonismo**: non applicabili criteri MDS-PD\n\n**PRINCIPIO**: Il parkinsonismo √® condizione necessaria ma non sufficiente per diagnosi MP",
    difficulty: 2,
    id: 36
},
{
    category: "Parkinson - Manifestazioni Cardinali",
    question: "Descrivi le caratteristiche specifiche delle tre manifestazioni cardinali del parkinsonismo secondo i criteri MDS-PD.",
    answer: "**1. BRADICINESIA** (obbligatoria):\n‚Ä¢ **Definizione**: lentezza movimento + decremento ampiezza/velocit√†\n‚Ä¢ **Caratteristica chiave**: esitazioni/arresti progressivi durante movimenti continuati\n‚Ä¢ **Sede**: documentata a livello arti\n\n**2. RIGIDIT√Ä**:\n‚Ä¢ **Definizione**: resistenza movimento passivo velocit√†-indipendente\n‚Ä¢ **Tipo**: 'a tubo di piombo' (lead-pipe)\n‚Ä¢ **Valutazione**: movimento passivo lento, paziente rilassato\n‚Ä¢ **ATTENZIONE**: 'ruota dentata' da sola NON sufficiente\n‚Ä¢ **DD**: vs spasticit√†, paratonia\n\n**3. TREMORE A RIPOSO**:\n‚Ä¢ **Frequenza**: 4-6 Hz\n‚Ä¢ **Condizioni**: arto completamente a riposo\n‚Ä¢ **Soppressione**: all'inizio movimento\n‚Ä¢ **ESCLUSIVO**: tremori cinetici/posturali da soli NON sufficienti\n\n**CRITERIO MINIMO**: Bradicinesia + (tremore riposo OR rigidit√†)",
    difficulty: 2,
    id: 37
},
{
    category: "Parkinson - Livelli Certezza Diagnostica",
    question: "Illustra i due livelli di certezza diagnostica MDS-PD: criteri richiesti e obiettivi di accuratezza.",
    answer: "**MP CLINICAMENTE STABILITA**:\n‚Ä¢ **Criteri richiesti**:\n  1. Assenza criteri esclusione assoluta\n  2. Almeno 2 criteri di supporto\n  3. Nessuna red flag\n‚Ä¢ **Obiettivo**: massimizzare specificit√† (‚â•90% casi veri MP)\n‚Ä¢ **Uso**: conferma diagnostica massima certezza\n\n**MP CLINICAMENTE PROBABILE**:\n‚Ä¢ **Criteri richiesti**:\n  1. Assenza criteri esclusione assoluta\n  2. Red flags bilanciate da criteri supporto\n  3. Massimo 2 red flags totali\n‚Ä¢ **Obiettivo**: equilibrio sensibilit√†/specificit√† (‚â•80% casi veri MP)\n‚Ä¢ **Uso**: screening, casi con alcune caratteristiche atipiche\n\n**SISTEMA BILANCIAMENTO**:\n‚Ä¢ **1 red flag** = minimo 1 criterio supporto\n‚Ä¢ **2 red flags** = minimo 2 criteri supporto\n‚Ä¢ **>2 red flags** = NON diagnosticabile MP Probabile\n\n**PRINCIPIO**: Stabilita = alta specificit√†; Probabile = alta sensibilit√†",
    difficulty: 3,
    id: 38
},
{
    category: "Parkinson - Criteri Esclusione Assoluta",
    question: "Elenca tutti i 9 criteri di esclusione assoluta per la diagnosi di MP secondo MDS-PD.",
    answer: "**DEFINIZIONE**: Presenza di qualsiasi criterio esclude MP (Probabile E Stabilita)\n**SIGNIFICATO**: Segni altamente specifici di diagnosi alternative\n\n**TUTTI I 9 CRITERI**:\n\n**1. ANOMALIE CEREBELLARI INEQUIVOCABILI**:\n‚Ä¢ Atassia deambulazione/arti, anomalie oculomotorie cerebellari\n\n**2. PARALISI SGUARDO VERTICALE**:\n‚Ä¢ Sopranucleare verso il basso\n‚Ä¢ Rallentamento selettivo saccadi verticali verso basso\n\n**3. DEMENZA FRONTOTEMPORALE PRECOCE**:\n‚Ä¢ Variante comportamentale O afasia progressiva primaria\n‚Ä¢ **Timing**: entro primi 5 anni malattia\n\n**4. PARKINSONISMO LIMITATO ARTI INFERIORI**:\n‚Ä¢ **Durata**: >3 anni, **Sede**: solo arti inferiori\n\n**5. PARKINSONISMO INDOTTO DA FARMACI**:\n‚Ä¢ Bloccanti recettori dopaminergici/agenti che deprimono dopamina\n‚Ä¢ **Compatibilit√†**: dose e timing coerenti\n\n**6. MANCATA RISPOSTA LEVODOPA**:\n‚Ä¢ **Dose**: ‚â•600 mg/die, **Gravit√†**: almeno moderata\n\n**7. PERDITA SENSORIALE CORTICALE**:\n‚Ä¢ Grafestesia, stereognosi, aprassia ideomotoria, afasia progressiva\n\n**8. NEUROIMAGING DOPAMINERGICO NORMALE**:\n‚Ä¢ Imaging funzionale sistema presinaptico normale (se eseguito)\n\n**9. CONDIZIONE ALTERNATIVA**:\n‚Ä¢ Documentazione condizione alternativa O giudizio clinico esperto\n\n**PRINCIPIO**: Qualsiasi criterio presente = STOP diagnosi MP",
    difficulty: 3,
    id: 39
},
{
    category: "Parkinson - Red Flags",
    question: "Descrivi tutte le 10 red flags dei criteri MDS-PD e i criteri per l'insufficienza autonomica grave.",
    answer: "**DEFINIZIONE**: Potenziali segni patologia alternativa\n**GESTIONE**: Controbilanciate da criteri supporto per MP Probabile\n\n**TUTTE LE 10 RED FLAGS**:\n\n**1. PROGRESSIONE RAPIDA DEAMBULAZIONE**:\n‚Ä¢ **Outcome**: sedia a rotelle regolare entro 5 anni esordio\n\n**2. ASSENZA PROGRESSIONE SINTOMI**:\n‚Ä¢ **Durata**: ‚â•5 anni senza progressione (eccetto se correlata a trattamento)\n\n**3. DISFUNZIONE BULBARE PRECOCE**:\n‚Ä¢ **Manifestazioni**: disfonia/disartria/disfagia grave\n‚Ä¢ **Gravit√†**: richiede cibo morbido/sonda NG/gastrostomia\n‚Ä¢ **Timing**: entro primi 5 anni\n\n**4. DISFUNZIONE RESPIRATORIA INSPIRATORIA**:\n‚Ä¢ **Manifestazioni**: stridore inspiratorio, sospiri inspiratori frequenti\n\n**5. INSUFFICIENZA AUTONOMICA GRAVE PRECOCE** (primi 5 anni):\n‚Ä¢ **Ipotensione ortostatica**: ‚Üì30 mmHg sistolica O ‚Üì15 mmHg diastolica (3 min)\n‚Ä¢ **Ritenzione urinaria**: non da stress, associata a disfunzione erettile (maschi)\n\n**6. CADUTE RICORRENTI PRECOCI**:\n‚Ä¢ **Frequenza**: >1/anno da deterioramento equilibrio entro 3 anni\n\n**7. DISTONIE SPROPORZIONATE**:\n‚Ä¢ **Manifestazioni**: anterocolli distonico, contratture mani/piedi\n‚Ä¢ **Timing**: entro primi 10 anni\n\n**8. ASSENZA CARATTERISTICHE NON MOTORIE**:\n‚Ä¢ **Durata**: nonostante 5 anni malattia\n‚Ä¢ **Caratteristiche**: insonnia, sonnolenza, RBD, costipazione, urgenza, iposmia, depressione, ansia, allucinazioni\n\n**9. SEGNI TRATTO PIRAMIDALE**:\n‚Ä¢ **Manifestazioni**: debolezza piramidale, iperreflessia altrimenti inspiegabili\n\n**10. PARKINSONISMO BILATERALE SIMMETRICO**:\n‚Ä¢ **Esordio**: bilaterale senza predominanza osservata",
    difficulty: 3,
    id: 41
},
{
    category: "Parkinson - Criteri di Supporto",
    question: "Descrivi i 4 criteri di supporto MDS-PD che aumentano la sicurezza diagnostica di MP.",
    answer: "**DEFINIZIONE**: Caratteristiche positive che aumentano sicurezza diagnosi MP\n**RUOLO**: Bilanciano red flags per MP Probabile\n\n**CRITERIO 1 - RISPOSTA DOPAMINERGICA DRAMMATICA**:\n‚Ä¢ **Trattamento iniziale**: ritorno funzione normale/quasi normale\n‚Ä¢ **Alternative**: \n  - Miglioramento marcato ‚Üëdose OR peggioramento marcato ‚Üìdose\n  - Cambiamenti >30% MDS-UPDRS III\n  - Fluttuazioni on/off inequivocabili con end-of-dose wearing off\n\n**CRITERIO 2 - DISCINESIA INDOTTA DA LEVODOPA**:\n‚Ä¢ **Significato**: complicanza tipica terapia long-term\n‚Ä¢ **Specificit√†**: altamente specifica per MP vs altri parkinsonismi\n\n**CRITERIO 3 - TREMORE A RIPOSO ARTO**:\n‚Ä¢ **Documentazione**: esame clinico (passato O attuale)\n‚Ä¢ **Specificit√†**: caratteristico MP\n\n**CRITERIO 4 - TEST DIAGNOSTICI ACCESSORI**:\n‚Ä¢ **Specificit√† richiesta**: >80% vs altri parkinsonismi\n‚Ä¢ **Test qualificanti**: perdita olfattiva, scintigrafia MIBG (denervazione simpatica cardiaca)",
    difficulty: 3,
    id: 43
},
{
    category: "Parkinson - Sistema Bilanciamento Diagnostico",
    question: "Spiega il sistema di bilanciamento tra red flags e criteri di supporto per la diagnosi di MP Probabile.",
    answer: "**PRINCIPIO FONDAMENTALE**:\nRed flags = segnali di allarme che devono essere 'compensati' da evidenze positive (criteri supporto)\n\n**REGOLE DI BILANCIAMENTO**:\n\n**SCENARIO 1: 1 Red Flag**\n‚Ä¢ **Minimo richiesto**: 1 criterio di supporto\n‚Ä¢ **Risultato**: MP Clinicamente Probabile possibile\n\n**SCENARIO 2: 2 Red Flags**\n‚Ä¢ **Minimo richiesto**: 2 criteri di supporto\n‚Ä¢ **Risultato**: MP Clinicamente Probabile possibile\n\n**SCENARIO 3: >2 Red Flags**\n‚Ä¢ **Risultato**: MP Clinicamente Probabile NON diagnosticabile\n‚Ä¢ **Ragione**: troppe caratteristiche atipiche\n\n**SCENARIO 4: 0 Red Flags**\n‚Ä¢ **Requisito**: 2 criteri supporto per MP Stabilita\n‚Ä¢ **Requisito**: 1 criterio supporto per MP Probabile (teorico)\n\n**LOGICA CLINICA**:\n‚Ä¢ Pi√π caratteristiche atipiche = maggiore evidenza positiva richiesta\n‚Ä¢ Sistema quantitativo per decisioni diagnostiche\n‚Ä¢ Bilanciamento tra sensibilit√† e specificit√†",
    difficulty: 3,
    id: 44
},
{
    category: "Parkinson - Test Diagnostici Accessori",
    question: "Quali sono i test diagnostici accessori qualificanti per i criteri di supporto MDS-PD e le loro specificit√†?",
    answer: "**REQUISITI GENERALI**:\n‚Ä¢ **Specificit√† minima**: >80% nella DD MP vs altri parkinsonismi\n‚Ä¢ **Utilizzo**: come criterio di supporto per diagnosi\n\n**TEST ATTUALMENTE QUALIFICANTI**:\n\n**1. PERDITA OLFATTIVA**:\n‚Ä¢ **Range patologico**: anosmico O chiaramente iposmico\n‚Ä¢ **Aggiustamenti**: per et√† e sesso\n‚Ä¢ **Metodologia**: test standardizzati (UPSIT, Sniffin' Sticks)\n‚Ä¢ **Significato**: compromissione precoce e specifica nella MP\n\n**2. SCINTIGRAFIA MIBG CARDIACA**:\n‚Ä¢ **Target**: innervazione simpatica cardiaca\n‚Ä¢ **Risultato patologico**: denervazione simpatica cardiaca chiaramente documentata\n‚Ä¢ **Specificit√†**: distingue MP da altri parkinsonismi\n‚Ä¢ **Meccanismo**: disfunzione autonomica caratteristica MP\n\n**LIMITI ATTUALI**:\n‚Ä¢ **Solo 2 test qualificanti**: campo in evoluzione\n‚Ä¢ **Disponibilit√†**: non sempre routinariamente disponibili\n‚Ä¢ **Costo-efficacia**: valutazione caso per caso\n\n**PROSPETTIVE**: Possibili futuri test (DaTscan, Œ±-sinucleina, biomarcatori)",
    difficulty: 2,
    id: 45
},
{
    category: "Parkinson - Applicazione Pratica Criteri MDS-PD",
    question: "Illustra l'approccio step-by-step per applicare i criteri diagnostici MDS-PD nella pratica clinica.",
    answer: "**STEP 1: CONFERMA PARKINSONISMO**\n‚Ä¢ **Verifica**: Bradicinesia + (tremore riposo OR rigidit√†)\n‚Ä¢ **Se assente**: STOP - criteri MDS-PD non applicabili\n\n**STEP 2: ESCLUSIONE ASSOLUTA**\n‚Ä¢ **Verifica**: tutti i 9 criteri di esclusione\n‚Ä¢ **Se presente qualsiasi**: STOP - MP esclusa\n\n**STEP 3: CONTA RED FLAGS**\n‚Ä¢ **Identifica**: numero red flags presenti (0-10)\n‚Ä¢ **Se >2**: STOP - MP Probabile non diagnosticabile\n\n**STEP 4: CONTA CRITERI SUPPORTO**\n‚Ä¢ **Identifica**: numero criteri supporto presenti (0-4)\n\n**STEP 5: BILANCIAMENTO E DIAGNOSI**\n‚Ä¢ **0 red flags + ‚â•2 supporto**: MP Clinicamente Stabilita\n‚Ä¢ **0 red flags + 1 supporto**: MP Clinicamente Probabile\n‚Ä¢ **1 red flag + ‚â•1 supporto**: MP Clinicamente Probabile\n‚Ä¢ **2 red flags + ‚â•2 supporto**: MP Clinicamente Probabile\n‚Ä¢ **Altri scenari**: MP non diagnosticabile\n\n**DOCUMENTAZIONE**: Registrare specificatamente red flags e criteri supporto identificati",
    difficulty: 3,
    id: 46
}
        ];
        
        // Variabili globali
        let allFlashcards = [...flashcardsData];
        let currentDeck = [...flashcardsData];
        let currentCardIndex = 0;
        let isFlipped = false;
        let cardsStudied = 0;
        let correctAnswers = 0;
        let currentStreak = 0;
        let sessionStats = {
            easy: 0,
            medium: 0,
            hard: 0
        };
        let selectedCategories = new Set();
        let studyHistory = {};
        let editingCardIndex = null;

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedProgress();
            initializeCategories();
            updateStats();
            checkEmptyState();
            updateProgress();
        });

        // Controllo stato vuoto
        function checkEmptyState() {
            if (allFlashcards.length === 0) {
                document.getElementById('flashcardContainer').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
            } else {
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('flashcardContainer').style.display = 'block';
                showCurrentCard();
            }
        }

        // Inizializza categorie
        function initializeCategories() {
            const categories = [...new Set(allFlashcards.map(card => card.category))];
            const categoryList = document.getElementById('categoryList');
            
            if (categories.length === 0) {
                categoryList.innerHTML = '<p style="text-align: center; color: #94a3b8;">Nessun argomento disponibile. Aggiungi alcune flashcard!</p>';
                return;
            }
            
            categoryList.innerHTML = categories.map(category => `
                <div class="category-item">
                    <input type="checkbox" id="cat-${category}" value="${category}" checked>
                    <label for="cat-${category}" style="cursor: pointer; flex: 1;">
                        ${category} (${allFlashcards.filter(card => card.category === category).length} carte)
                    </label>
                </div>
            `).join('');
            
            // Seleziona tutte le categorie di default
            categories.forEach(cat => selectedCategories.add(cat));
        }

        // Mostra carta corrente
        function showCurrentCard() {
            const container = document.getElementById('flashcardContainer');
            if (currentCardIndex >= currentDeck.length) {
                showSessionComplete();
                return;
            }

            const card = currentDeck[currentCardIndex];
            container.innerHTML = `
                <div class="flashcard" id="currentFlashcard" onclick="flipCard(event)">
                    <button class="edit-btn" onclick="openEditModal(event)">‚úèÔ∏è Modifica</button>
                    <div class="category-badge">${card.category}</div>
                    <div class="flashcard-front">
                        <h2 style="color: #a5b4fc; margin-bottom: 15px;">‚ùì Domanda</h2>
                        <p>${card.question}</p>
                    </div>
                    <div class="flashcard-back">
                        <h2 style="color: #a5b4fc; margin-bottom: 15px;">‚úÖ Risposta</h2>
                        <p>${card.answer}</p>
                        <div class="difficulty-buttons">
                            <button class="difficulty-btn easy" onclick="markDifficulty('easy', event)">
                                üòä Facile
                            </button>
                            <button class="difficulty-btn medium" onclick="markDifficulty('medium', event)">
                                ü§î Medio
                            </button>
                            <button class="difficulty-btn hard" onclick="markDifficulty('hard', event)">
                                üò∞ Difficile
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('currentCard').textContent = currentCardIndex + 1;
            document.getElementById('totalCards').textContent = currentDeck.length;
            isFlipped = false;
        }

        // Flip carta - funzione corretta
        function flipCard(event) {
            // Evita di girare la carta se si clicca sui pulsanti
            if (event.target.classList.contains('edit-btn') || 
                event.target.classList.contains('difficulty-btn') ||
                event.target.closest('.difficulty-buttons')) {
                return;
            }
            
            const flashcard = document.getElementById('currentFlashcard');
            if (flashcard) {
                flashcard.classList.toggle('flipped');
                isFlipped = !isFlipped;
            }
        }

        // Segna difficolt√†
        function markDifficulty(difficulty, event) {
            event.stopPropagation();
            
            const card = currentDeck[currentCardIndex];
            
            // Aggiorna statistiche
            sessionStats[difficulty]++;
            cardsStudied++;
            
            // Salva nella storia con algoritmo migliorato
            if (!studyHistory[card.id]) {
                studyHistory[card.id] = {
                    studied: 0,
                    correct: 0,
                    lastStudied: null,
                    difficulty: 'medium',
                    interval: 1,
                    easeFactor: 2.5
                };
            }
            
            const history = studyHistory[card.id];
            history.studied++;
            history.lastStudied = new Date().toISOString();
            history.difficulty = difficulty;
            
            // Algoritmo SM-2 migliorato per ripetizione spaziata
            if (difficulty === 'easy') {
                correctAnswers++;
                currentStreak++;
                history.correct++;
                history.easeFactor = Math.max(1.3, history.easeFactor + 0.1);
                history.interval = Math.ceil(history.interval * history.easeFactor);
                showToast('üéâ Ottimo lavoro! Ripeterai tra ' + history.interval + ' giorni', 'success');
            } else if (difficulty === 'medium') {
                currentStreak = Math.floor(currentStreak / 2);
                history.easeFactor = Math.max(1.3, history.easeFactor - 0.08);
                history.interval = Math.ceil(history.interval * 1.2);
                showToast('üëç Bene! Ripeterai tra ' + history.interval + ' giorni', 'success');
            } else {
                currentStreak = 0;
                history.easeFactor = Math.max(1.3, history.easeFactor - 0.2);
                history.interval = 1;
                showToast('üí™ Continua a studiare! Rivedrai domani', 'success');
                currentDeck.push({...card});
            }

            saveProgressToLocalStorage();
            
            // Passa alla prossima carta
            setTimeout(() => {
                currentCardIndex++;
                updateStats();
                updateProgress();
                showCurrentCard();
            }, 1500);
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // Aggiorna statistiche
        function updateStats() {
            document.getElementById('cardsStudied').textContent = cardsStudied;
            document.getElementById('correctAnswers').textContent = correctAnswers;
            document.getElementById('streak').textContent = currentStreak;
            
            const totalCardsInSystem = allFlashcards.length;
            const studiedCardsCount = Object.keys(studyHistory).length;
            const totalProgress = totalCardsInSystem > 0 ? Math.round((studiedCardsCount / totalCardsInSystem) * 100) : 0;
            document.getElementById('totalProgress').textContent = totalProgress + '%';
        }

        // Aggiorna barra di progresso
        function updateProgress() {
            const progress = currentDeck.length > 0 ? (currentCardIndex / currentDeck.length) * 100 : 0;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Gestione categorie
        function openCategoryModal() {
            if (allFlashcards.length === 0) {
                showToast('Aggiungi prima alcune flashcard!', 'info');
                return;
            }
            document.getElementById('categoryModal').style.display = 'block';
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
        }

        function selectAllCategories() {
            const checkboxes = document.querySelectorAll('#categoryList input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
        }

        function deselectAllCategories() {
            const checkboxes = document.querySelectorAll('#categoryList input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
        }

        function applyCategoryFilter() {
            selectedCategories.clear();
            const checkboxes = document.querySelectorAll('#categoryList input[type="checkbox"]:checked');
            
            checkboxes.forEach(cb => {
                selectedCategories.add(cb.value);
            });
            
            if (selectedCategories.size === 0) {
                showToast('Seleziona almeno una categoria!', 'error');
                return;
            }
            
            currentDeck = allFlashcards.filter(card => selectedCategories.has(card.category));
            currentCardIndex = 0;
            
            closeCategoryModal();
            checkEmptyState();
            updateProgress();
            showToast(`${currentDeck.length} carte selezionate`, 'success');
        }

        // Modifica carta
        function openEditModal(event) {
            event.stopPropagation();
            if (currentDeck.length === 0) return;
            
            editingCardIndex = currentCardIndex;
            const card = currentDeck[currentCardIndex];
            
            document.getElementById('editCategory').value = card.category;
            document.getElementById('editQuestion').value = card.question;
            document.getElementById('editAnswer').value = card.answer;
            
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingCardIndex = null;
        }

        function saveCardEdits() {
            if (editingCardIndex === null) return;
            
            const card = currentDeck[editingCardIndex];
            const newCategory = document.getElementById('editCategory').value.trim();
            const newQuestion = document.getElementById('editQuestion').value.trim();
            const newAnswer = document.getElementById('editAnswer').value.trim();
            
            if (!newCategory || !newQuestion || !newAnswer) {
                showToast('Tutti i campi sono obbligatori!', 'error');
                return;
            }
            
            card.category = newCategory;
            card.question = newQuestion;
            card.answer = newAnswer;
            
            const originalCard = allFlashcards.find(c => c.id === card.id);
            if (originalCard) {
                originalCard.category = newCategory;
                originalCard.question = newQuestion;
                originalCard.answer = newAnswer;
            }
            
            saveProgressToLocalStorage();
            
            closeEditModal();
            initializeCategories();
            showCurrentCard();
            showToast('Carta modificata con successo!', 'success');
        }

        // Aggiungi nuova carta
        function openAddCardModal() {
            document.getElementById('addCardCategory').value = '';
            document.getElementById('addCardQuestion').value = '';
            document.getElementById('addCardAnswer').value = '';
            document.getElementById('addCardModal').style.display = 'block';
        }

        function closeAddCardModal() {
            document.getElementById('addCardModal').style.display = 'none';
        }

        function addNewCard() {
            const category = document.getElementById('addCardCategory').value.trim();
            const question = document.getElementById('addCardQuestion').value.trim();
            const answer = document.getElementById('addCardAnswer').value.trim();

            if (!category || !question || !answer) {
                showToast('Tutti i campi sono obbligatori!', 'error');
                return;
            }

            const newId = allFlashcards.length > 0 ? Math.max(...allFlashcards.map(c => c.id || 0)) + 1 : 1;
            
            const newCard = {
                category: category,
                question: question,
                answer: answer,
                difficulty: 1,
                id: newId 
            };

            allFlashcards.push(newCard);
            initializeCategories();

            if (selectedCategories.has(category) || allFlashcards.length === 1) {
                selectedCategories.add(category);
                if (!currentDeck.find(card => card.id === newCard.id)) {
                    currentDeck.push(newCard);
                    document.getElementById('totalCards').textContent = currentDeck.length;
                }
            }
            
            saveProgressToLocalStorage();
            checkEmptyState();
            updateStats();
            showToast('Nuova carta aggiunta con successo!', 'success');
            closeAddCardModal();
        }

        // Salva/Carica progresso
        function saveProgressToLocalStorage() {
            const saveData = {
                studyHistory: studyHistory,
                sessionStats: sessionStats,
                cardsStudied: cardsStudied,
                correctAnswers: correctAnswers,
                currentStreak: currentStreak,
                flashcardsData: allFlashcards,
                selectedCategories: Array.from(selectedCategories),
                savedDate: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('neuroCards3AnnoProgress', JSON.stringify(saveData));
            } catch (e) {
                console.log('localStorage non disponibile');
            }
        }

        function saveProgress() {
            saveProgressToLocalStorage();
            
            const saveData = {
                studyHistory: studyHistory,
                sessionStats: sessionStats,
                cardsStudied: cardsStudied,
                correctAnswers: correctAnswers,
                currentStreak: currentStreak,
                flashcardsData: allFlashcards,
                selectedCategories: Array.from(selectedCategories),
                savedDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(saveData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `neurocards-3anno-progress-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            setTimeout(() => URL.revokeObjectURL(url), 100);
            showToast('Progresso salvato! File scaricato.', 'success');
        }

        function loadProgress() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        studyHistory = data.studyHistory || {};
                        sessionStats = data.sessionStats || {easy: 0, medium: 0, hard: 0};
                        cardsStudied = data.cardsStudied || 0;
                        correctAnswers = data.correctAnswers || 0;
                        currentStreak = data.currentStreak || 0;
                        
                        if (data.flashcardsData) {
                            allFlashcards = data.flashcardsData;
                            currentDeck = [...allFlashcards];
                        }
                        
                        if (data.selectedCategories) {
                            selectedCategories = new Set(data.selectedCategories);
                        }
                        
                        currentCardIndex = 0;
                        initializeCategories();
                        updateStats();
                        checkEmptyState();
                        updateProgress();
                        
                        showToast('Progresso caricato con successo!', 'success');
                    } catch (error) {
                        showToast('Errore nel caricamento del file!', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function loadSavedProgress() {
            try {
                const saved = localStorage.getItem('neuroCards3AnnoProgress');
                if (saved) {
                    const data = JSON.parse(saved);
                    studyHistory = data.studyHistory || {};
                    if (data.flashcardsData) {
                        allFlashcards = data.flashcardsData;
                        currentDeck = [...allFlashcards];
                    }
                    if (data.selectedCategories) {
                        selectedCategories = new Set(data.selectedCategories);
                    }
                }
            } catch (error) {
                console.log('localStorage non disponibile');
            }
        }

        // Funzioni utility
        function shuffleCards() {
            if (currentDeck.length === 0) {
                showToast('Nessuna carta da mescolare!', 'info');
                return;
            }
            
            for (let i = currentDeck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentDeck[i], currentDeck[j]] = [currentDeck[j], currentDeck[i]];
            }
            currentCardIndex = 0;
            showCurrentCard();
            updateProgress();
            showToast('Carte mescolate!', 'success');
        }

        function resetSession() {
            if (confirm('Sei sicuro di voler resettare la sessione?')) {
                currentCardIndex = 0;
                cardsStudied = 0;
                correctAnswers = 0;
                currentStreak = 0;
                sessionStats = { easy: 0, medium: 0, hard: 0 };
                currentDeck = allFlashcards.filter(card => selectedCategories.has(card.category));
                
                document.getElementById('sessionComplete').style.display = 'none';
                
                updateStats();
                updateProgress();
                checkEmptyState();
                showToast('Sessione resettata!', 'success');
            }
        }

        function showOnlyDifficult() {
            const difficultCards = allFlashcards.filter(card => {
                const history = studyHistory[card.id];
                return history && history.difficulty === 'hard';
            });
            
            if (difficultCards.length === 0) {
                showToast('Nessuna carta difficile trovata!', 'info');
                return;
            }
            
            currentDeck = difficultCards;
            currentCardIndex = 0;
            checkEmptyState();
            updateProgress();
            showToast(`${difficultCards.length} carte difficili caricate`, 'success');
        }

        function showSessionComplete() {
            document.getElementById('flashcardContainer').style.display = 'none';
            document.getElementById('sessionComplete').style.display = 'block';
            
            const accuracy = cardsStudied > 0 ? Math.round((correctAnswers / cardsStudied) * 100) : 0;
            const summary = document.getElementById('sessionSummary');
            summary.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <strong>Carte studiate:</strong> ${cardsStudied}<br>
                    <strong>Accuratezza:</strong> ${accuracy}%<br>
                    <strong>Serie massima:</strong> ${currentStreak}
                </div>
                <div>
                    <span style="color: #10b981;">Facili: ${sessionStats.easy}</span> | 
                    <span style="color: #f59e0b;">Medie: ${sessionStats.medium}</span> | 
                    <span style="color: #ef4444;">Difficili: ${sessionStats.hard}</span>
                </div>
            `;
        }

        function restartSession() {
            resetSession();
        }

        // Gestione tastiera migliorata
        document.addEventListener('keydown', function(event) {
            // Non processare se siamo in un modal
            if (document.getElementById('sessionComplete').style.display !== 'none') return;
            if (document.getElementById('editModal').style.display === 'block') return;
            if (document.getElementById('addCardModal').style.display === 'block') return;
            if (document.getElementById('categoryModal').style.display === 'block') return;
            if (currentDeck.length === 0) return;
            
            switch(event.key.toLowerCase()) {
                case ' ':
                    event.preventDefault();
                    flipCard({target: document.getElementById('currentFlashcard')});
                    break;
                case '1':
                    if (isFlipped) markDifficulty('easy', event);
                    break;
                case '2':
                    if (isFlipped) markDifficulty('medium', event);
                    break;
                case '3':
                    if (isFlipped) markDifficulty('hard', event);
                    break;
                case 'e':
                    event.preventDefault();
                    openEditModal(event);
                    break;
            }
        });

        // Chiudi modali cliccando fuori
        window.onclick = function(event) {
            const categoryModal = document.getElementById('categoryModal');
            const editModal = document.getElementById('editModal');
            const addCardModal = document.getElementById('addCardModal');

            if (event.target == categoryModal) {
                categoryModal.style.display = "none";
            }
            if (event.target == editModal) {
                editModal.style.display = "none";
            }
            if (event.target == addCardModal) {
                addCardModal.style.display = "none";
            }
        }
    </script>
</body>
</html>
